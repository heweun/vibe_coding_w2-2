name: Issue Auto Assigner

on:
  issues:
    types: [opened]

jobs:
  assign:
    runs-on: ubuntu-latest
    steps:
    - name: Auto assign issue
      uses: actions/github-script@v7
      with:
        script: |
          const { owner, repo, number } = context.issue;
          const issue = context.payload.issue;
          const issueAuthor = issue.user.login;
          
          // íŒ€ ë©¤ë²„ ëª©ë¡ (í”„ë¡œì íŠ¸ì— ë§ê²Œ ìˆ˜ì •)
          const teamMembers = {
            'backend': ['heweun'],
            'frontend': ['heweun'],
            'devops': ['heweun'],
            'general': ['heweun']
          };
          
          // ì´ìŠˆ ë‚´ìš© ë¶„ì„í•˜ì—¬ ì ì ˆí•œ ë‹´ë‹¹ì ì„ íƒ
          const title = issue.title.toLowerCase();
          const body = issue.body ? issue.body.toLowerCase() : '';
          
          let category = 'general';
          
          if (title.includes('backend') || title.includes('api') || title.includes('server') || 
              body.includes('backend') || body.includes('fastapi')) {
            category = 'backend';
          } else if (title.includes('frontend') || title.includes('ui') || title.includes('streamlit') || 
                     body.includes('frontend') || body.includes('interface')) {
            category = 'frontend';
          } else if (title.includes('deploy') || title.includes('ci') || title.includes('docker') || 
                     body.includes('deployment') || body.includes('github actions')) {
            category = 'devops';
          }
          
          // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ë‹´ë‹¹ì ì¤‘ ì„ íƒ (ì‘ì„±ì ì œì™¸)
          const availableAssignees = teamMembers[category].filter(member => member !== issueAuthor);
          
          if (availableAssignees.length > 0) {
            // ëœë¤í•˜ê²Œ ë‹´ë‹¹ì ì„ íƒ (ë˜ëŠ” ë¡œë“œë°¸ëŸ°ì‹± ë¡œì§ êµ¬í˜„ ê°€ëŠ¥)
            const selectedAssignee = availableAssignees[Math.floor(Math.random() * availableAssignees.length)];
            
            try {
              await github.rest.issues.addAssignees({
                owner,
                repo,
                issue_number: number,
                assignees: [selectedAssignee]
              });
              
              console.log(`ë‹´ë‹¹ì í• ë‹¹ ì™„ë£Œ: ${selectedAssignee} (ì¹´í…Œê³ ë¦¬: ${category})`);
              
              // ë‹´ë‹¹ì í• ë‹¹ ì•Œë¦¼ ëŒ“ê¸€
              await github.rest.issues.createComment({
                owner,
                repo,
                issue_number: number,
                body: `ğŸ‘¥ **ë‹´ë‹¹ì í• ë‹¹**: @${selectedAssignee}ë‹˜ì´ ì´ ì´ìŠˆë¥¼ ë‹´ë‹¹í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nì¹´í…Œê³ ë¦¬: \`${category}\``
              });
              
            } catch (error) {
              console.log('ë‹´ë‹¹ì í• ë‹¹ ì‹¤íŒ¨:', error.message);
              
              // ì‹¤íŒ¨ ì‹œ ì¼ë°˜ ë‹´ë‹¹ìì—ê²Œ í• ë‹¹
              if (teamMembers.general.length > 0) {
                const fallbackAssignee = teamMembers.general[0];
                try {
                  await github.rest.issues.addAssignees({
                    owner,
                    repo,
                    issue_number: number,
                    assignees: [fallbackAssignee]
                  });
                  console.log(`ëŒ€ì²´ ë‹´ë‹¹ì í• ë‹¹ ì™„ë£Œ: ${fallbackAssignee}`);
                } catch (fallbackError) {
                  console.log('ëŒ€ì²´ ë‹´ë‹¹ì í• ë‹¹ë„ ì‹¤íŒ¨:', fallbackError.message);
                }
              }
            }
          } else {
            console.log('í• ë‹¹ ê°€ëŠ¥í•œ ë‹´ë‹¹ìê°€ ì—†ìŠµë‹ˆë‹¤.');
          } 